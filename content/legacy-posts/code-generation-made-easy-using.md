---
title: 'Code generation made easy using patterns'
date: 2008-04-18T05:44:00.000-07:00
draft: false
tags : [code generation, netbeans, java]
---

Since starting developing some code generation plugins ([toString() generator](http://imyousuf-tech.blogs.smartitengineering.com/2008/04/netbeans-generating-tostring-for-java.html) and [Java Util Logger Generator](http://imyousuf-tech.blogs.smartitengineering.com/2008/04/netbeans-generating-java-util-logger.html)) using/for the [NetBeans 6.1Beta](http://www.netbeans.org/community/releases/61/) I have learnt a lot and the more I worked on it I kept asking myself how could I make it easier. Once both the plugins took rudimentary form I learnt and discovered that patterns could make this task whole lot easier for me. So I started re-implementing the Logger generator (if you are interested in getting the resources please check the logger blog) plugin.  
  
Now I wanted to implement that the plugin will search for System.out.print(ln) and out.print(ln) if static import exists. In doing so I had to walk the PARSED tree of a Java Source file. Just to give me a flavour that I am implementing something cool I called it JavaSourceTreeParser. Basically what it does is breaks down each every Java Statement to a form which can not be further decomposed. In the initial version the conversion was done in the parser it self ([Revision 21](http://code.google.com/p/smart-codegen/source/detail?r=21)). Then it felt that I could easily use [Observer pattern](http://en.wikipedia.org/wiki/Observer_pattern) for it and after implementing it ([Revision 31](http://code.google.com/p/smart-codegen/source/detail?r=31)) I saw that I am right and I achieved something which every code generator can use. (As I use [GIT SCM](http://imyousuf-tech.blogs.smartitengineering.com/2007/12/git-starting-using-git-as-your-scm.html) I usually work offline and make bunch of commits together so dont worry how I make multiple commits at a go :)).  
  
Once implementing it I found that for performance improvement and communication between various listeners I felt the need of session for state information sharing and then I decided to use [Composite pattern](http://en.wikipedia.org/wiki/Composite_pattern) for the purpose. and it also worked like a charm and as a result improving the overall performance of the plugins. The following diagram might give an idea how to use it using the API I designed.  
  
[![](http://3.bp.blogspot.com/_kWF3--nlqu8/SAnZMBhzgVI/AAAAAAAAAn8/PB3tce9-UqE/s320/CondeInjection.png)](http://3.bp.blogspot.com/_kWF3--nlqu8/SAnZMBhzgVI/AAAAAAAAAn8/PB3tce9-UqE/s1600-h/CondeInjection.png)  
  
What I implemented in the listener simply that the listener will get notified whenever the parser come across a particular type of tree, for System.out.println it would be MethodInvocationTree (Kind.METHOD\_INVOCATION), and the listener according to its implementation will handle the Tree; in my case I replaced the method invocation with a logger invocation. In case where I inserted a Log method at the beginning of every method body I listened to Kind.METHOD. Now I am implementing Log insertion for Throw, Return and End of Method block. In process I will also add parsing life cycle listener to the API so that modification to the class is done only once when the parsing is completed. I hope this API helps users interested in code generation. I am very interested to learn what users think about it.